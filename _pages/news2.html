<style>
  .carousel-container {
    position: relative;
    max-width: 800px;
    margin: 1rem auto;
    overflow: hidden;
  }

  .carousel-track {
    display: flex;
    transition: transform 0.5s ease-in-out;
    /* width will be set dynamically */
  }

  .carousel-buttons {
    text-align: center;
    margin-top: 1rem;
  }

  .carousel-buttons button {
    padding: 0.5rem 1rem;
    margin: 0 0.5rem;
    font-size: 1rem;
    cursor: pointer;
  }

  .article {
    background: #ffffff;
    border-radius: 10px;
    padding: 1rem;
    margin: 1rem auto;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    align-items: center;
    max-width: 800px;

    flex: 0 0 100%; /* Fix: each article takes full carousel width */
    box-sizing: border-box;
  }

  .article img {
    width: 100%;
    height: auto;
    max-height: 300px;
    object-fit: contain;
    border-radius: 6px;
    display: block;
    margin-bottom: 1rem;
  }

  .content {
    width: 100%;
    text-align: left;
  }

  .content h2 {
    margin: 0;
    font-size: 1.2em;
  }

  .content p {
    margin: 0.5rem 0;
  }

  .date {
    color: #666;
    font-size: 0.85em;
  }

  a {
    color: #007bff;
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }
</style>

<h1>üì∞ The New York Times</h1>
<div class="carousel-container">
  <div id="nyt-carousel" class="carousel-track"></div>
</div>
<div class="carousel-buttons">
  <button onclick="moveSlide(-1, 'nyt-carousel')">‚è™ Prev</button>
  <button onclick="moveSlide(1, 'nyt-carousel')">Next ‚è©</button>
</div>

<script>
  let currentIndex = 0;

  async function fetchnytRSS(url) {
    const res = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}`);
    const data = await res.json();
    return data.items;
  }

  function renderCarousel(items, containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';

    items.forEach(item => {
      const article = document.createElement('div');
      article.className = 'article';

      const image = document.createElement('img');
      const imageUrl =
        item.thumbnail && item.thumbnail.trim()
          ? item.thumbnail
          : item.enclosure?.link || 'https://dummyimage.com/600x400/ffffff/27272b.png&text=No+Image';
      image.src = imageUrl;
      image.alt = 'Thumbnail';

      const content = document.createElement('div');
      content.className = 'content';

      const title = document.createElement('h2');
      const link = document.createElement('a');
      link.href = 'http://archive.is/newest/' + item.link;
      link.target = '_blank';
      link.rel = 'noopener noreferrer';
      link.textContent = item.title;
      title.appendChild(link);

      const desc = document.createElement('p');
      desc.innerHTML = item.description || '';

      const pubDate = document.createElement('div');
      pubDate.className = 'date';
      pubDate.textContent = new Date(item.pubDate).toLocaleString();

      content.appendChild(title);
      content.appendChild(desc);
      content.appendChild(pubDate);

      article.appendChild(image);
      article.appendChild(content);

      container.appendChild(article);
    });

    // Important fix: set total width so transform % works correctly
    container.style.width = `${items.length * 100}%`;
  }

  function moveSlide(direction, containerId) {
    const container = document.getElementById(containerId);
    const articles = container.children;
    if (articles.length === 0) return;

    currentIndex += direction;

    if (currentIndex < 0) currentIndex = articles.length - 1;
    if (currentIndex >= articles.length) currentIndex = 0;

    const offset = -currentIndex * 100;
    container.style.transform = `translateX(${offset}%)`;
  }

  fetchnytRSS('https://rss.nytimes.com/services/xml/rss/nyt/World.xml')
    .then(items => renderCarousel(items, 'nyt-carousel'))
    .catch(err => {
      document.getElementById('nyt-carousel').innerText = 'Failed to load feed.';
      console.error(err);
    });
</script>
