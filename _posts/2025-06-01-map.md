---
layout: default
title: Map
permalink: /map/
---
A map of southern Africa showing daily land surface temperature.

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin></script>
<script src="https://unpkg.com/pmtiles@3.0.5/dist/pmtiles.js"></script>

<style>
.map-controls {
  margin: 1em 0;
  display: flex;
  gap: 1em;
  flex-wrap: wrap;
  align-items: center;
}
.legend {
  background: white;
  padding: 10px;
  border-radius: 5px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  margin-top: 1em;
}
.legend-gradient {
  width: 200px;
  height: 20px;
  background: linear-gradient(to right, white 0%, black 100%);
  border: 1px solid #ccc;
  margin: 5px 0;
}
.legend-labels {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  width: 200px;
}
.info-box {
  position: absolute;
  top: 10px;
  right: 10px;
  background: white;
  padding: 10px;
  border-radius: 5px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  z-index: 1000;
  max-width: 200px;
  font-size: 12px;
}
</style>

<div class="map-controls">
  <label>
    Opacity: 
    <input type="range" id="opacitySlider" min="0" max="100" value="90" />
    <span id="opacityValue">90%</span>
  </label>
  <button id="toggleLayer">Hide Temperature Layer</button>
  <button id="resetView">Reset View</button>
</div>

<div id="map" style="height: 500px; width: 100%; position: relative;">
  <div class="info-box" id="infoBox">
    <strong>Land Surface Temperature</strong><br>
    Data: MLST-AS (MSG satellite)<br>
    Updated: Daily at 18:00 UTC<br>
    <span id="dateInfo">Loading...</span>
  </div>
</div>

<div class="legend">
  <strong>Temperature Scale (°C)</strong>
  <div class="legend-gradient"></div>
  <div class="legend-labels">
    <span>0°C (Cold)</span>
    <span>25°C</span>
    <span>50°C (Hot)</span>
  </div>
  <small>White = Cold, Black = Hot. Transparent areas are outside 0-50°C range.</small>
</div>

<script>
document.addEventListener("DOMContentLoaded", async function () {
  // 1) Create the map
  const map = L.map('map').setView([-23, 25], 4);
  
  // Base layer
  const baseLayer = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap contributors'
  }).addTo(map);

  // Alternative base layers
  const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    attribution: '© Esri'
  });

  // Layer control
  const baseLayers = {
    "OpenStreetMap": baseLayer,
    "Satellite": satelliteLayer
  };
  L.control.layers(baseLayers).addTo(map);

  // Marker
  const marker = L.marker([-20.706790041949702, 25.359063235436718]).addTo(map)
    .bindPopup('Makgadikgadi Pans National Park')
    .openPopup();

  // 2) Temperature overlay
  let temperatureLayer = null;
  
  try {
    const pmtilesUrl = '{{ "/tiles/raster.pmtiles" | relative_url }}';
    const p = new pmtiles.PMTiles(pmtilesUrl);
    
    // Get header info for date
    p.getHeader().then(h => {
      console.log('PMTiles header:', h);
      document.getElementById('dateInfo').textContent = `Range: 0-50°C`;
    }).catch(console.error);
    
    temperatureLayer = pmtiles.leafletRasterLayer(p, { 
      opacity: 0.9,
      attribution: 'Temperature data: LSA SAF'
    })
      .on('tileerror', (e) => console.error('Tile load error:', e))
      .addTo(map);
      
  } catch (err) {
    console.error('PMTiles init error:', err);
    document.getElementById('dateInfo').textContent = 'Error loading data';
  }

  // 3) Controls
  const opacitySlider = document.getElementById('opacitySlider');
  const opacityValue = document.getElementById('opacityValue');
  const toggleButton = document.getElementById('toggleLayer');
  const resetButton = document.getElementById('resetView');

  // Opacity control
  opacitySlider.addEventListener('input', function() {
    const opacity = this.value / 100;
    opacityValue.textContent = this.value + '%';
    if (temperatureLayer) {
      temperatureLayer.setOpacity(opacity);
    }
  });

  // Toggle layer
  let layerVisible = true;
  toggleButton.addEventListener('click', function() {
    if (temperatureLayer) {
      if (layerVisible) {
        map.removeLayer(temperatureLayer);
        this.textContent = 'Show Temperature Layer';
        layerVisible = false;
      } else {
        map.addLayer(temperatureLayer);
        this.textContent = 'Hide Temperature Layer';
        layerVisible = true;
      }
    }
  });

  // Reset view
  resetButton.addEventListener('click', function() {
    map.setView([-23, 25], 4);
  });

  // Click handler for coordinates
  map.on('click', function(e) {
    const lat = e.latlng.lat.toFixed(4);
    const lng = e.latlng.lng.toFixed(4);
    
    L.popup()
      .setLatLng(e.latlng)
      .setContent(`
        <strong>Location</strong><br>
        Lat: ${lat}<br>
        Lng: ${lng}<br>
        <small>Temperature data resolution: ~3km</small>
      `)
      .openOn(map);
  });

  // Add scale
  L.control.scale({ position: 'bottomleft' }).addTo(map);

  // Add coordinates display
  const coordsControl = L.control({ position: 'bottomright' });
  coordsControl.onAdd = function() {
    const div = L.DomUtil.create('div', 'leaflet-control-attribution leaflet-control');
    div.innerHTML = '<span id="coords">Move mouse to see coordinates</span>';
    return div;
  };
  coordsControl.addTo(map);

  // Update coordinates on mouse move
  map.on('mousemove', function(e) {
    const coords = document.getElementById('coords');
    if (coords) {
      coords.textContent = `${e.latlng.lat.toFixed(4)}, ${e.latlng.lng.toFixed(4)}`;
    }
  });
});
</script>
